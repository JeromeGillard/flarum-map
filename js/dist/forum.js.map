{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@jeromegillard/flarum-osm/./src/common/index.ts","webpack://@jeromegillard/flarum-osm/./src/forum/components/File.js","webpack://@jeromegillard/flarum-osm/./src/forum/components/OSMMap.js","webpack://@jeromegillard/flarum-osm/./src/forum/index.js","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['app']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/Component']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/Model']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/app']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/extend']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/utils/mixin']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['components/Post']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['forum/app']\"","webpack://@jeromegillard/flarum-osm/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@jeromegillard/flarum-osm/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@jeromegillard/flarum-osm/webpack/bootstrap","webpack://@jeromegillard/flarum-osm/webpack/runtime/compat get default export","webpack://@jeromegillard/flarum-osm/webpack/runtime/define property getters","webpack://@jeromegillard/flarum-osm/webpack/runtime/hasOwnProperty shorthand","webpack://@jeromegillard/flarum-osm/webpack/runtime/make namespace object","webpack://@jeromegillard/flarum-osm/./forum.ts"],"sourcesContent":["import app from 'flarum/common/app';\n\napp.initializers.add('jeromegillard/flarum-osm', () => {\n  console.log('[jeromegillard/flarum-osm] Hello, forum and admin!');\n});\n","import app from 'flarum/app';\r\nimport Model from 'flarum/common/Model';\r\nimport mixin from 'flarum/common/utils/mixin';\r\n\r\nexport default class File extends mixin(Model, {\r\n    baseName: Model.attribute('baseName'),\r\n    path: Model.attribute('path'),\r\n    url: Model.attribute('url'),\r\n    type: Model.attribute('type'),\r\n    size: Model.attribute('size'),\r\n    humanSize: Model.attribute('humanSize'),\r\n    createdAt: Model.attribute('createdAt'),\r\n    uuid: Model.attribute('uuid'),\r\n    tag: Model.attribute('tag'),\r\n    hidden: Model.attribute('hidden'),\r\n}){\r\n\r\n\r\n    /**\r\n     * Use FoF Uploads endpoint\r\n     */\r\n    apiEndpoint() {\r\n        return '/fof/uploads' + (this.exists ? '/' + this.data.id : '');\r\n    }\r\n\r\n    /**\r\n     * Generate bbcode for this file\r\n     */\r\n    bbcode() {\r\n        console.log('checking')\r\n        console.log(this.tag())\r\n        switch (this.tag()) {\r\n            // THis is obviouslu not sustainable and the backend API should return thus bb (which is already defined) in the provider php\r\n            case 'gpx':\r\n                return `[upl-file uuid=${this.uuid()} size=${this.humanSize()} url=${this.url()}]${this.baseName()}[/upl-file]`;\r\n            // File\r\n            case 'file':\r\n                return `[upl-file uuid=${this.uuid()} size=${this.humanSize()}]${this.baseName()}[/upl-this]`;\r\n\r\n            // Image template\r\n            case 'image':\r\n                return `[upl-image uuid=${this.uuid()} size=${this.humanSize()} url=${this.url()}]${this.baseName()}[/upl-image]`;\r\n\r\n            // Image preview\r\n            case 'image-preview':\r\n                return `[upl-image-preview url=${this.url()}]`;\r\n\r\n            // 'just-url' or unknown\r\n            default:\r\n                return this.url();\r\n        }\r\n            \r\n    }\r\n\r\n\r\n}\r\n","import Component from 'flarum/common/Component';\r\nimport app from 'flarum/forum/app';\r\n\r\nexport default class OSMMap extends Component {\r\n  \r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n\r\n    this.mapboxKey = app.forum.attribute(\"osm.mapbox\");\r\n  }\r\n\r\n  view() {\r\n    /*return (\r\n      <div>\r\n        Count: {this.count}\r\n        <button onclick={e => this.count++}>\r\n          {this.attrs.buttonLabel}\r\n        </button>\r\n      </div>\r\n    );*/\r\n    return (\r\n        <div id={'map'+this.attrs.pid}></div>\r\n    );\r\n  }\r\n\r\n  oncreate(vnode) {\r\n    super.oncreate(vnode);\r\n\r\n    var map = L.map('map'+ this.attrs.pid).setView([50.4631,5.7533], 13);\r\n\r\n    var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token='+this.mapboxKey, \r\n    {\r\n      maxZoom: 18,\r\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, ' +\r\n        'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\r\n      id: 'mapbox/light-v9',\r\n      tileSize: 512,\r\n      zoomOffset: -1\r\n    }).addTo(map);\r\n  }\r\n}\r\n\r\n//m.mount(document.body, <MyComponent buttonLabel=\"Increment\" />);","import app from 'flarum/forum/app';\nimport Post from 'flarum/components/Post';\nimport { extend } from 'flarum/common/extend';\nimport OSMMap from './components/OSMMap';\nimport File from './components/File';\n\napp.initializers.add('jeromegillard/flarum-osm', () => {\n  console.log('[jeromegillard/flarum-osm] Hello, forum!');\n\n  app.store.models.files = File;\n});\n\nextend(Post.prototype, 'oncreate', function () {\n  let postId = this.attrs.post.id();\n  console.log(\"Found post id #\", postId), this.attrs.post;\n\n  \n  let mapboxKey = app.forum.attribute(\"osm.mapbox\");\n  \n  //for each gpx file in this post, loop and map\n  this.$('.osmFile').each(function( i ) {\n    let url = app.forum.attribute('apiUrl') + '/fof/download';\n            url += '/' + $(this).data('fofUploadDownloadUuid');\n            url += '/' + postId;\n            url += '/' + app.session.csrfToken;\n    console.log(url);\n    let uuid = $(this).data('fofUploadDownloadUuid');\n    let map = L.map('map-'+uuid).setView([50.4631,5.7533], 13);\n\n    let tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token='+mapboxKey, \n    {\n      maxZoom: 18,\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, ' +\n        'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n      id: 'mapbox/light-v9',\n      tileSize: 512,\n      zoomOffset: -1\n    }).addTo(map);\n\n  });\n\n});","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/utils/mixin'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['forum/app'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/common';\nexport * from './src/forum';\n"],"names":["app","initializers","add","console","log","Model","mixin","File","apiEndpoint","exists","data","id","bbcode","tag","uuid","humanSize","url","baseName","attribute","path","type","size","createdAt","hidden","Component","OSMMap","oninit","vnode","mapboxKey","forum","view","attrs","pid","oncreate","map","L","setView","tiles","tileLayer","maxZoom","attribution","tileSize","zoomOffset","addTo","Post","extend","store","models","files","prototype","postId","post","$","each","i","session","csrfToken","setPrototypeOf","_inheritsLoose","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","bind","__proto__"],"sourceRoot":""}