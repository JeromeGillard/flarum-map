{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@jeromegillard/flarum-osm/./src/common/index.ts","webpack://@jeromegillard/flarum-osm/./src/forum/components/File.js","webpack://@jeromegillard/flarum-osm/./src/forum/index.js","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['app']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/Model']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/app']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/extend']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['common/utils/mixin']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['components/Post']\"","webpack://@jeromegillard/flarum-osm/external root \"flarum.core.compat['forum/app']\"","webpack://@jeromegillard/flarum-osm/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@jeromegillard/flarum-osm/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@jeromegillard/flarum-osm/webpack/bootstrap","webpack://@jeromegillard/flarum-osm/webpack/runtime/compat get default export","webpack://@jeromegillard/flarum-osm/webpack/runtime/define property getters","webpack://@jeromegillard/flarum-osm/webpack/runtime/hasOwnProperty shorthand","webpack://@jeromegillard/flarum-osm/webpack/runtime/make namespace object","webpack://@jeromegillard/flarum-osm/./forum.ts"],"sourcesContent":["import app from 'flarum/common/app';\n\napp.initializers.add('jeromegillard/flarum-osm', () => {\n  console.log('[jeromegillard/flarum-osm] Hello, forum and admin!');\n});\n","import app from 'flarum/app';\r\nimport Model from 'flarum/common/Model';\r\nimport mixin from 'flarum/common/utils/mixin';\r\n\r\nexport default class File extends mixin(Model, {\r\n    baseName: Model.attribute('baseName'),\r\n    path: Model.attribute('path'),\r\n    url: Model.attribute('url'),\r\n    type: Model.attribute('type'),\r\n    size: Model.attribute('size'),\r\n    humanSize: Model.attribute('humanSize'),\r\n    createdAt: Model.attribute('createdAt'),\r\n    uuid: Model.attribute('uuid'),\r\n    tag: Model.attribute('tag'),\r\n    hidden: Model.attribute('hidden'),\r\n    cuuid: Model.attribute('cuuid'),\r\n}){\r\n\r\n\r\n    /**\r\n     * Use FoF Uploads endpoint\r\n     */\r\n    apiEndpoint() {\r\n        return '/fof/uploads' + (this.exists ? '/' + this.data.id : '');\r\n    }\r\n\r\n    /**\r\n     * Generate bbcode for this file\r\n     */\r\n    bbcode() {\r\n        //console.log('checking')\r\n        //console.log(this.tag())\r\n        switch (this.tag()) {\r\n            // THis is obviouslu not sustainable and the backend API should return thus bb (which is already defined) in the provider php\r\n            case 'osm':\r\n            case 'gpx':\r\n                return `[upl-file uuid=${this.uuid()} size=${this.humanSize()} url=${this.url()}]${this.baseName()}[/upl-file]`;\r\n            // File\r\n            case 'file':\r\n                return `[upl-file uuid=${this.uuid()} size=${this.humanSize()}]${this.baseName()}[/upl-this]`;\r\n\r\n            // Image template\r\n            case 'image':\r\n                return `[upl-image uuid=${this.uuid()} size=${this.humanSize()} url=${this.url()}]${this.baseName()}[/upl-image]`;\r\n\r\n            // Image preview\r\n            case 'image-preview':\r\n                return `[upl-image-preview url=${this.url()}]`;\r\n\r\n            // 'just-url' or unknown\r\n            default:\r\n                return this.url();\r\n        }\r\n            \r\n    }\r\n\r\n\r\n}\r\n","import app from 'flarum/forum/app';\nimport Post from 'flarum/components/Post';\nimport { extend } from 'flarum/common/extend';\nimport File from './components/File';\n\napp.initializers.add('jeromegillard/flarum-osm', () => {\n  app.store.models.files = File;\n});\n\nextend(Post.prototype, 'oncreate', function () {\n  let postId = this.attrs.post.id();\n  let mapboxKey = app.forum.attribute(\"osm.mapbox\");\n  \n  //for each gpx file in this post, loop and map\n  this.$('.osmFile').each(function( i ) {\n    let url = app.forum.attribute('apiUrl') + '/fof/download';\n            url += '/' + $(this).data('fofUploadDownloadUuid');\n            url += '/' + postId;\n            url += '/' + app.session.csrfToken;\n    \n    // grab the uploaded gpx file's UUID\n    let uuid = $(this).data('fofUploadDownloadUuid');\n\n    /*  change the template rendering to insert a new id to the map element.\n      * this allows us to have an unique div id even if a same file is displayed\n      * more than one time\n    */\n    var oldNode = document.getElementById('map--'+uuid);\n    var newNode = oldNode.cloneNode(true);\n    newNode.id = 'map-'+postId+i+'-'+uuid;\n    oldNode.parentNode.replaceChild(newNode, oldNode);\n\n    // Get the map element\n    let map = L.map('map-'+postId+i+'-'+uuid);\n\n    // Set the tiles provider\n    let tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token='+mapboxKey, \n    {\n      maxZoom: 18,\n      attribution: 'Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors, ' +\n        'Imagery Â© <a href=\"https://www.mapbox.com/\">Mapbox</a>',\n      id: 'mapbox/light-v9',\n      tileSize: 512,\n      zoomOffset: -1\n    }).addTo(map);\n\n    // Display the GPX file in it thanks to https://github.com/mpetazzoni/leaflet-gpx\n    new L.GPX(url, \n        {\n          async: true,\n          marker_options: {\n            startIconUrl: '/assets/extensions/jeromegillard-osm/pin-icon-start.png',\n            endIconUrl: '/assets/extensions/jeromegillard-osm/pin-icon-end.png',\n            shadowUrl: '/assets/extensions/jeromegillard-osm/pin-shadow.png',\n            wptIconUrls: {\n              '': '/assets/extensions/jeromegillard-osm/default-waypoint.png',\n              'Geocache Found': '/assets/extensions/jeromegillard-osm/geocache.png',\n              'Park': '/assets/extensions/jeromegillard-osm/tree.png'\n            },\n          }\n        }\n      ).on('loaded', function(e) {\n      map.fitBounds(e.target.getBounds());\n    }).addTo(map);\n\n  });\n\n});","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['common/Model'];","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/utils/mixin'];","module.exports = flarum.core.compat['components/Post'];","module.exports = flarum.core.compat['forum/app'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export * from './src/common';\nexport * from './src/forum';\n"],"names":["app","initializers","add","console","log","Model","mixin","File","apiEndpoint","exists","data","id","bbcode","tag","uuid","humanSize","url","baseName","attribute","path","type","size","createdAt","hidden","cuuid","Post","extend","store","models","files","prototype","postId","attrs","post","mapboxKey","forum","$","each","i","session","csrfToken","oldNode","document","getElementById","newNode","cloneNode","parentNode","replaceChild","map","L","tiles","tileLayer","maxZoom","attribution","tileSize","zoomOffset","addTo","GPX","async","marker_options","startIconUrl","endIconUrl","shadowUrl","wptIconUrls","on","e","fitBounds","target","getBounds","setPrototypeOf","_inheritsLoose","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","bind","__proto__"],"sourceRoot":""}